<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Test Product Page</title>
    <link rel="stylesheet" type="text/css" href="/default.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="../JS/listing2.js"></script>
</head>
<body>
    <p th:text="'Hello, ' + ${name} + '!'"></p>
    <p th:text="'Currently showing: ' + ${productName} + ' products'"></p>
    <p>This is a sample page that demonstrates frontend API loading.</p>
    <table id="listingTableLeft"></table>
    <table id="listingTableRight"></table>
    <!--JS Marker-->
    <script th:inline="javascript">

        function listingParse() {
            return new Promise((resolve, reject) =>
            {
                $.ajax({
                    url: "http://api.icndb.com/jokes/random?exclude=explicit",
                    type: "GET",
                    cache: false,
                    datatype: "json",
                    success: function(result) {
                        // setTimeout(function(){}, 10000)
                        resolve(result)
                    },
                    error: function(result) {
                        reject(result)
                    },
                    async: true
                })
            })
        }

        /*<![CDATA[*/
        const numLoaded = /*[[${numLoaded}]]*/"Default";
        /*]]>*/

        for (let i = 0; i < parseInt(numLoaded); i++) {

            let tr = document.createElement('tr');
            let td = document.createElement('td');
            let text = document.createTextNode("Currently loading");
            tr.id = "pid" + i;

            td.append(text);
            tr.append(td);
            if (i % 2 === 0) {
                $("#listingTableLeft").append(tr);
            } else {
                $("#listingTableRight").append(tr);
            }

            listingParse()
                .then(
                    function(result) {
                        let text = "Name: " + result.type + "\nID: " + i + "\n";
                        $("#pid" + i).text(text);
                    })
                .catch(error => $("pid" + i).append(error));
        }



        // $.getJSON("http://api.icndb.com/jokes/random?exclude=explicit", function result(){
        //     $.each(result, function(i, field){
        //         $(pTest).append(field + " ");
        //     });
        // });

        // $(pTest).text("Done");
        // const formattedText = JSON.stringify(temp, null, '\t');

        // $(pTest).val(temp.value);

    </script>
<!--
<div style="text-align:left">
    <table id="listingTableLeft">
        <tbody id="leftTableBody"></tbody>
            &lt;!&ndash; Set product values to be displayed. &ndash;&gt;
            &lt;!&ndash;
            <td th:text="${product.name}">Name</td>
            <td th:text="'No. '+ ${product.id}">ID Number</td>
            <td th:text="'$'+${product.cost}">Cost</td>
            <td th:text="${product.content}">Content</td>
            &ndash;&gt;
    </table>
</div>

<div style="text-align: right">
    <table id="ListingTableRight">
        <tr th:each="product : ${products}"
            th:if="${product.id} % 2 == 1">
            <input type="hidden" th:id="'p-id' + ${product.id}" th:value="${product}"/>
            <script src="../../java/com/example/serverdemo/listing2.js" async></script>
            <td th:text="${product.name}">Name</td>
            <td th:text="'No. '+ ${product.id}">ID Number</td>
            <td th:text="'$'+${product.cost}">Cost</td>
            <td th:text="${product.content}">Content</td>
        </tr>
    </table>
</div>
-->

<footer id="footer">
    <a href="/index.html">Go home</a>
</footer>
</body>
</html>
